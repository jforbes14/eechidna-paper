# Results

## Spatial autoregressive parameter

The spatial autoregressive coefficient $\rho$ is positive and significant in only the 2001 and 2016 elections (Figure \@ref(fig:rhovis)), meaning that in these elections, an electorate's political climate was affected by the attitudes of it's neighbours. Conversely, in the other four elections, the spatial effect weakens to become insignficant. In these years, it appears that the spatial component does not explain anything over and above the electoral socio-demographics, meaning electorates effectively acted more independently.

```{r rhovis, fig.cap="Estimates of the spatial autoregressive parameter for each of the six elections, with a 95\\% confidence interval. Only in 2001 and 2016 is there a significant spatial component", out.height='20%'}
rho_df <- bind_rows(glsmod16$rho_df %>% mutate(year = "2016"), 
  glsmod13$rho_df %>% mutate(year = "2013"),
  glsmod10$rho_df %>% mutate(year = "2010"), 
  glsmod07$rho_df %>% mutate(year = "2007"),
  glsmod04$rho_df %>% mutate(year = "2004"), 
  glsmod01$rho_df %>% mutate(year = "2001")) %>% 
  mutate(upper95 = estimate + 1.96*se, lower95 = estimate - 1.96*se)

rho_df %>% ggplot() + 
  geom_point(aes(x = year, y = estimate), size = 3) +
  geom_linerange(aes(x = year, ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 1) +
  scale_color_manual(values = c("grey50", "black")) +
  labs(x = "Election year", y = "Estimate of spatial autoregressive parameter") +
  lims(y = c(-1,1)) +
  guides(col = F) +
  coord_fixed(ratio = 1)
```

## Country-wide trend
Since all socio-demographics have been standardized to have a mean of zero and a variance of one, the intercept in each model can be interpreted as the estimated two-party preferred vote for an electorate with mean characteristics[^3]. The baseline of party preference has varied over the elections, with the biggest swing occuring in the 2007 election where the mean electorate shifted more than five percentage points in favour of the Labor party.

[^3]: Mean of all variables aside from Judaism, Indigenous, Islam and Buddhism, where it assumes the mean of the log value.

```{r plotintercept, fig.cap = "Estimated intercept for each election, which represents the two-party preferred vote for an electorate with mean characteristics.", out.height="20%"}
intercept_df <- bind_rows(data.frame(summary(glsmod16)$tTable)[1, ]  %>% mutate(year = "2016"), 
  data.frame(summary(glsmod13)$tTable)[1, ] %>% mutate(year = "2013"),
  data.frame(summary(glsmod10)$tTable)[1, ] %>% mutate(year = "2010"), 
  data.frame(summary(glsmod07)$tTable)[1, ] %>% mutate(year = "2007"),
  data.frame(summary(glsmod04)$tTable)[1, ] %>% mutate(year = "2004"), 
  data.frame(summary(glsmod01)$tTable)[1, ] %>% mutate(year = "2001")) %>% 
  rename(se = `Std.Error`, estimate = Value, p = `p.value`) %>% 
  mutate(upper95 = estimate + 1.96*se, lower95 = estimate - 1.96*se)

intercept_df %>% ggplot() + 
  geom_point(aes(x = year, y = estimate), size = 2) +
  geom_linerange(aes(x = year, ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 50), alpha = 0.5, size = 1) +
  labs(x = "Election year", y = "Estimate of intercept") +
  guides(col = F) +
  coord_fixed(ratio = 0.2) +
  lims(y = c(45, 55))
```


## Influential socio-demographics
To investigate the socio-demographics that have a strong effect on the two-party preferred vote, partial residual plots are used. These show the direction, size and significance of an estimated effect - the slope of the prediction line matches the estimated coefficient, and the shaded region represents a 95% confidence band. If a horizontal line can be drawn through the confidence band, then the effect is insignificant. Plots for each election are faceted to compare the effects over time.

*It is important here to note the ecological fallacy - insights are being drawn at the electorate level, and cannot be inferred for another disaggregate level (e.g. individual voters).*


```{r myvisreg, include = F}
# Function to produce visreg style conditional plots
my_visreg <- function(my_model, sp_weights, varname, 
  plot = FALSE, nolabs = FALSE, xlimits = NULL, ylimits = NULL, year = "") {
  
  # Extract fitted parameters
  rho <- my_model$rho_df$estimate
  sigma <- sqrt(sum(my_model$residuals^2)/(my_model$dims$N-my_model$dims$p))
  
  # Spatial weights
  w_mat <- listw2mat(sp_weights)
  
  # Q - where u = Qe, Q = (I - pW)^-1
  q_mat <- solve(diag(my_model$dims$N) - rho*w_mat)
  
  # Omega - QQ'
  omega_mat <- q_mat%*%t(q_mat)
  
  # X
  x_mat <- my_model$my_data %>% 
    dplyr::select(-c(LNP_Percent, year, DivisionNm)) %>% 
    mutate(Intercept = 1) %>% 
    dplyr::select(Intercept, everything()) %>% 
    as.matrix()
  
  # Beta
  beta_mat <- my_model$coefficients
  
  # T value
  t = qt(0.975, nrow(my_model$gls_data)-ncol(my_model$gls_data))
  
  # Lambda matrix (FGLS)
  x <- round(seq(min(as.numeric(x_mat[, varname])), max(as.numeric(x_mat[, varname])), 0.025), 3)
  lambda_mat <- data.frame(matrix(0, nrow = length(x), ncol = ncol(x_mat)))
  names(lambda_mat) <- dimnames(x_mat)[[2]]
  lambda_mat[, varname] <- x
  lambda_mat$Intercept <- 1
  lambda_mat <- as.matrix(lambda_mat)
  
  # Confidence interval
  plot_df <- data.frame(variable = x, fitted = lambda_mat%*%beta_mat, variance = 0)
  
  for (i in 1:nrow(lambda_mat)) {
    lambda <- lambda_mat[i, ]
    plot_df$variance[i] = sigma^2 * t(lambda) %*% 
      solve(t(x_mat) %*% solve(omega_mat) %*% x_mat) %*% 
      lambda
  }
  
  plot_df <- plot_df %>% 
    mutate(upper95 = fitted + t*sqrt(variance), lower95 = fitted - t*sqrt(variance))
  
  # Partial residuals
  points_df <- data.frame(
    variable = my_model$my_data[, varname] %>% unname,
    part_res = (my_model$my_data$LNP_Percent - x_mat%*%my_model$coefficients) + my_model$coefficients[varname]*x_mat[, varname] + my_model$coefficients[1]
  )
  
  # Plot
  if (plot == TRUE) {
      myplot <- ggplot(data = plot_df) + 
    geom_ribbon(aes(x = variable, ymin = lower95, ymax = upper95), fill = "grey80") + 
    geom_point(aes(x = variable, y = part_res), data = points_df, size = 0.75, col = "grey50") + 
    geom_line(aes(x = variable, y = fitted), col = "blue", size = 1) +
    #geom_hline(aes(yintercept = min(upper95)), col = "red") +
    #geom_hline(aes(yintercept = max(lower95)), col = "blue") +
    theme_bw() + 
    labs(x = varname, y = "Response") + 
    ggtitle(year) +
    theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))
  
  if (nolabs == TRUE) {
    myplot <- myplot + labs(x = "", y = "")
  }
  
  if (!is.null(xlimits) & !is.null(ylimits)) {
    myplot <- myplot + coord_cartesian(xlim = xlimits, ylim = ylimits)
  }
      return(myplot)
  }

  # Points
  if (plot == FALSE) {
    return_ls <- list(bands = plot_df, points = points_df)
    
    return(return_ls)
  }
  
  
}

# Grid visreg
grid_visreg <- function(varname, xvar_title = "", xlimits = NULL, ylimits = NULL, plot = FALSE) {
  if (plot == TRUE) {
    p16 <- my_visreg(glsmod16, sp_weights_16, varname = varname, plot = T, nolabs = T, 
      year = "2016", xlimits, ylimits)
    p13 <- my_visreg(glsmod13, sp_weights_13, varname = varname, plot = T, nolabs = T, 
      year = "2013", xlimits, ylimits)
    p10 <- my_visreg(glsmod10, sp_weights_10, varname = varname, plot = T, nolabs = T, 
      year = "2010", xlimits, ylimits)
    p07 <- my_visreg(glsmod07, sp_weights_07, varname = varname, plot = T, nolabs = T, 
      year = "2007", xlimits, ylimits)
    p04 <- my_visreg(glsmod04, sp_weights_04, varname = varname, plot = T, nolabs = T, 
      year = "2004", xlimits, ylimits)
    p01 <- my_visreg(glsmod01, sp_weights_01, varname = varname, plot = T, nolabs = T, 
      year = "2001", xlimits, ylimits)
  
    plots <- grid.arrange(p01, p04, p07, p10, p13, p16, nrow = 2, 
      left = grid.text("Two-party preferred vote (%)", gp = gpar(cex = 0.8), rot = 90), 
      bottom = grid.text(xvar_title, gp = gpar(cex = 0.8)))
  
  return(plots)
  }
  
  if (plot == FALSE) {
    p16 <- my_visreg(glsmod16, sp_weights_16, varname = varname, plot = F, year = "2016")
    p13 <- my_visreg(glsmod13, sp_weights_13, varname = varname, plot = F, year = "2013")
    p10 <- my_visreg(glsmod10, sp_weights_10, varname = varname, plot = F, year = "2010")
    p07 <- my_visreg(glsmod07, sp_weights_07, varname = varname, plot = F, year = "2007")
    p04 <- my_visreg(glsmod04, sp_weights_04, varname = varname, plot = F, year = "2004")
    p01 <- my_visreg(glsmod01, sp_weights_01, varname = varname, plot = F, year = "2001")
    
    bands_df <- bind_rows(
      p16$bands %>% mutate(year = "2016"),
      p13$bands %>% mutate(year = "2013"),
      p10$bands %>% mutate(year = "2010"),
      p07$bands %>% mutate(year = "2007"),
      p04$bands %>% mutate(year = "2004"),
      p01$bands %>% mutate(year = "2001")
    )
    
    points_df <- bind_rows(
      p16$points %>% mutate(year = "2016"),
      p13$points %>% mutate(year = "2013"),
      p10$points %>% mutate(year = "2010"),
      p07$points %>% mutate(year = "2007"),
      p04$points %>% mutate(year = "2004"),
      p01$points %>% mutate(year = "2001")
    )
    
    return_df <- list(bands = bands_df, points = points_df)
    
    return(return_df)
  }
  
}

```


### Income and unemployment

Typically the Labor party campaigns on more progressive policies, which often include tax reform that adversely affects higher income earners, and more generous social assistance programs. Perhaps due to these policies, higher income electorates have been more likely to support the Liberal party, as the `Incomes` factor has a positive effect on Liberal preference (see Figure \@ref(fig:plotincomes)). This effect is signficant in every election aside from 2004, in which it is only marginally insignificant ($p = 0.0613$). Unemployment however, has not been as influential. In 2001 and 2004, electorates with higher unemployment were more likely to support Labor, but over time this has shifted towards support for the Liberal party, culminating in a significantly positive effect in 2016.

```{r plotincomes, fig.cap = "Effect of Incomes", out.width="100%"}
p <- grid_visreg("Incomes", xvar_title = "Incomes", plot = T, xlimits = c(-1.5, 3.6), ylimits = c(30, 95))
```

```{r plotunemploy, fig.cap = "Effect of Unemployment", out.width="60%"}
p <- grid_visreg("Unemployment", xvar_title = "Unemployment", plot = T, xlimits = c(-2.1, 3.4), ylimits = c(28, 68))
```

### Industry and type of work
Electorates with higher proportions of workers in mining, gas, water, agriculture, waste and electricity (grouped as `Extractive` industries) are consistently linked with higher support for the Liberal party, with the mangitude of this effect slightly increasing over the years (see Figure \@ref(fig:plotextractive)). This is unsurprising, as the Liberal party has close ties with these traditional energy industries, and typically present policies to reduce taxation on energy production. Furthermore, electorates with more workers in construction or manufacturing industries (`Transformative`) are also more likely to support the Liberal party (see Figure \@ref(fig:plottransformative)).

```{r plotextractive, fig.cap = "Effect of Extractive", out.width="60%"}
p <- grid_visreg("Extractive", xvar_title = "Extractive", xlimits = c(-0.7, 3.4), ylimits = c(35, 81), plot = T)
```

```{r plottransformative, fig.cap = "Effect of Transformative", out.width="60%"}
p <- grid_visreg("Transformative", xvar_title = "Transformative", xlimits = c(-2.25, 2.9), ylimits = c(34, 75), plot = T)
```

Similarly, workers in managerial, administrative, clerical and sales roles (`ManagerAdminClericalSales`) is also a significant predictor of two-party preference vote across all six elections, with a higher proportion of people working these jobs increasing Liberal support. The magnitude of this effect has also increased over the years.

```{r plotmanager, fig.cap = "Effect of ManagerAdminClericalSales", out.width="60%"}
p <- grid_visreg("ManagerAdminClericalSales", xvar_title = "ManagerAdminClericalSales", xlimits = c(-3.75, 2.8), ylimits = c(32, 70), plot = T)
```


### Household mobility
```{r plotdiffaddress, fig.cap = "Effect of DiffAddress", out.width="60%"}
p <- grid_visreg("DiffAddress", xvar_title = "DiffAddress", xlimits = c(-2.1, 3.65), ylimits = c(34, 81), plot = T)
```

In each of the six elections, electorates with a higher proportion of people that have recently moved house (meaning in last five years) were more likely to support the Liberal party, although this effect was marginally insignificant in 2013. Having controlled for characteristics of house ownership and rental prices (via the factors `PropertyOwned` and `RentLoan` respectively), this is effect is somewhat surprising.

### Relationships and age
De facto relationships, but not marriages, is found to be an important (and significant) predictor of the two-party preferred vote in all six elections, with more de facto relationships associated with higher support for the Labor party. 

```{r plotdefacto, fig.cap = "Effect of DeFacto", out.width="60%", eval = F}
p <- grid_visreg("DeFacto", xvar_title = "DeFacto", xlimits = c(-2.2, 5.1), ylimits = c(12, 83), plot = T)
```

Although only significant in 2007 and 2010, older electorates (higher median age) are consistently more likely to support the Liberal party. 

```{r plotage, fig.cap = "Effect of MedianAge", out.width="60%", eval = F}
p <- grid_visreg("MedianAge", xvar_title = "MedianAge", xlimits = c(-2.5, 2.7), ylimits = c(31, 70), plot = T)
```

### Education
Since 2007, electorates with higher education levels have been associated with supporting the Labor party, although this effect is only significant in 2016. Prior to 2007, education had no material effect.

```{r ploteducation, fig.cap = "Effect of Education", out.width="60%", eval = F}
p <- grid_visreg("Education", xvar_title = "Education", xlimits = c(-2.5, 2.7), ylimits = c(31, 70), plot = T)
```

### Diversity
Larger migrant populations from Asia, the Middle East, South-Eastern Europe, the United Kingdom and elsewhere, are assocated with Labor support, or had no effect. Of these areas, only South-Eastern European populations were signficant in each election and Asian migrants were a significant in 2010. However, the effect of other languages (aside from English) is a far stronger effect, as observed through `OtherLanguageHome`. Surprisingly, electorates with more diverse speech were more likely to support the Liberal party from 2004 onwards, with this effect being significant in 2007, 2010 and 2016.

Of the variables relating to religion, only Judaism shows a consistent effect, with electorates with larger Jewish populations more likely to vote Liberal. 

```{r plototherlanguagehome, fig.cap = "Effect of OtherLanguageHome", out.width="60%", eval = F}
p <- grid_visreg("OtherLanguageHome", xvar_title = "OtherLanguageHome", xlimits = c(-1.1, 3.5), ylimits = c(5, 80), plot = T)
```


```{r plotbornse, fig.cap = "Effect of Born_SE_Europe", out.width="60%", eval = F}
p <- grid_visreg("Born_SE_Europe", xvar_title = "Born_SE_Europe", xlimits = c(-0.9, 5), ylimits = c(20, 70), plot = T)
```

```{r plotbornasia, fig.cap = "Effect of Born_Asia", out.width="60%", eval = F}
p <- grid_visreg("Born_Asia", xvar_title = "Born_Asia", xlimits = c(-0.9, 5), ylimits = c(20, 70), plot = T)
```

```{r plotjudaism, fig.cap = "Effect of Judaism", out.width="60%", eval = F}
p <- grid_visreg("Judaism", xvar_title = "Judaism", xlimits = c(-1.5, 3.8), ylimits = c(40, 70), plot = T)
```

### Partial residual plots

```{r}
vars_to_plot <- c("Judaism", "Born_Asia", "Born_SE_Europe", "OtherLanguageHome", "Education", "MedianAge", "DeFacto", "DiffAddress", "ManagerAdminClericalSales", "Transformative", "Extractive", "Unemployment", "Incomes")

ls_visreg <- list(Judaism = grid_visreg("Judaism"), Born_Asia = grid_visreg("Born_Asia"), Born_SE_Europe = grid_visreg("Born_SE_Europe"), OtherLanguageHome = grid_visreg("OtherLanguageHome"), Education = grid_visreg("Education"), MedianAge = grid_visreg("MedianAge"), DeFacto = grid_visreg("DeFacto"), DiffAddress = grid_visreg("DiffAddress"), ManagerAdminClericalSales = grid_visreg("ManagerAdminClericalSales"), Transformative = grid_visreg("Transformative"), Extractive = grid_visreg("Extractive"), Unemployment = grid_visreg("Unemployment"), Incomes = grid_visreg("Incomes"))

all_bands_df <- bind_rows(
  ls_visreg$Judaism$bands %>% mutate(varname = "Judaism", xmin = -1.5, xmax = 3.8),
  ls_visreg$Born_Asia$bands %>% mutate(varname = "Born_Asia", xmin = -0.9, xmax = 5.15),
  ls_visreg$Born_SE_Europe$bands %>% mutate(varname = "Born_SE_Europe", xmin = -0.85, xmax = 5.05),
  ls_visreg$OtherLanguageHome$bands %>% mutate(varname = "OtherLanguageHome", xmin = -1, xmax = 3.4),
  ls_visreg$Education$bands %>% mutate(varname = "Education", xmin = -1.3, xmax = 3),
  ls_visreg$MedianAge$bands %>% mutate(varname = "MedianAge", xmin = -2.55, xmax = 2.8),
  ls_visreg$DeFacto$bands %>% mutate(varname = "DeFacto", xmin = -2.2, xmax = 5.05),
  ls_visreg$DiffAddress$bands %>% mutate(varname = "DiffAddress", xmin = -2.2, xmax = 3.75),
  ls_visreg$ManagerAdminClericalSales$bands %>% mutate(varname = "ManagerAdminClericalSales", xmin = -3.75, xmax = 2.85),
  ls_visreg$Transformative$bands %>% mutate(varname = "Transformative", xmin = -2.3, xmax = 2.92),
  ls_visreg$Extractive$bands %>% mutate(varname = "Extractive", xmin = -0.75, xmax = 3.45),
  ls_visreg$Unemployment$bands %>% mutate(varname = "Unemployment", xmin = -2.08, xmax = 3.37),
  ls_visreg$Incomes$bands %>% mutate(varname = "Incomes", xmin = -1.5, xmax = 3.65)
)

all_points_df <- bind_rows(
  ls_visreg$Judaism$points %>% mutate(varname = "Judaism"),
  ls_visreg$Born_Asia$points %>% mutate(varname = "Born_Asia"),
  ls_visreg$Born_SE_Europe$points %>% mutate(varname = "Born_SE_Europe"),
  ls_visreg$OtherLanguageHome$points %>% mutate(varname = "OtherLanguageHome"),
  ls_visreg$Education$points %>% mutate(varname = "Education"),
  ls_visreg$MedianAge$points %>% mutate(varname = "MedianAge"),
  ls_visreg$DeFacto$points %>% mutate(varname = "DeFacto"),
  ls_visreg$DiffAddress$points %>% mutate(varname = "DiffAddress"),
  ls_visreg$ManagerAdminClericalSales$points %>% mutate(varname = "ManagerAdminClericalSales"),
  ls_visreg$Transformative$points %>% mutate(varname = "Transformative"),
  ls_visreg$Extractive$points %>% mutate(varname = "Extractive"),
  ls_visreg$Unemployment$points %>% mutate(varname = "Unemployment"),
  ls_visreg$Incomes$points %>% mutate(varname = "Incomes")
)

ggplot(data = all_bands_df %>% filter(varname %in% vars_to_plot[8:13])) +
  geom_ribbon(aes(x = variable, ymin = lower95, ymax = upper95), fill = "grey80") + 
  geom_point(aes(x = variable, y = part_res), data = all_points_df %>% filter(varname %in% vars_to_plot[8:13]), size = 0.75, col = "grey50") + 
  geom_line(aes(x = variable, y = fitted), col = "blue", size = 1) +
  theme_bw()+ 
  labs(x = varname, y = "Response") + 
  facet_wrap(varname ~ year, ncol = 6, scales = "free")


my_x_ranges <- range(range(model_df$Judaism), range(model_df$Born_Asia), range(model_df$Born_SE_Europe), range(model_df$OtherLanguageHome), range(model_df$Education), range(model_df$MedianAge), range(model_df$DeFacto), range(model_df$DiffAddress), range(model_df$ManagerAdminClericalSales), range(model_df$Transformative), range(model_df$Extractive), range(model_df$Unemployment), range(model_df$Incomes))

my_y_ranges <- range(
  range(c(ls_visreg$Judaism$bands$upper95, ls_visreg$Judaism$bands$lower95, ls_visreg$Judaism$points$part_res)),
  range(c(ls_visreg$Born_Asia$bands$upper95, ls_visreg$Born_Asia$bands$lower95, ls_visreg$Born_Asia$points$part_res)),
  range(c(ls_visreg$Born_SE_Europe$bands$upper95, ls_visreg$Born_SE_Europe$bands$lower95, ls_visreg$Born_SE_Europe$points$part_res)),
  range(c(ls_visreg$OtherLanguageHome$bands$upper95, ls_visreg$OtherLanguageHome$bands$lower95, ls_visreg$OtherLanguageHome$points$part_res)),
  range(c(ls_visreg$Education$bands$upper95, ls_visreg$Education$bands$lower95, ls_visreg$Education$points$part_res)),
  range(c(ls_visreg$MedianAge$bands$upper95, ls_visreg$MedianAge$bands$lower95, ls_visreg$MedianAge$points$part_res)),
  range(c(ls_visreg$DeFacto$bands$upper95, ls_visreg$DeFacto$bands$lower95, ls_visreg$DeFacto$points$part_res)),
  range(c(ls_visreg$DiffAddress$bands$upper95, ls_visreg$DiffAddress$bands$lower95, ls_visreg$DiffAddress$points$part_res)),
  range(c(ls_visreg$ManagerAdminClericalSales$bands$upper95, ls_visreg$ManagerAdminClericalSales$bands$lower95, ls_visreg$ManagerAdminClericalSales$points$part_res)),
  range(c(ls_visreg$Transformative$bands$upper95, ls_visreg$Transformative$bands$lower95, ls_visreg$Transformative$points$part_res)),
  range(c(ls_visreg$Extractive$bands$upper95, ls_visreg$Extractive$bands$lower95, ls_visreg$Extractive$points$part_res)),
  range(c(ls_visreg$Unemployment$bands$upper95, ls_visreg$Unemployment$bands$lower95, ls_visreg$Unemployment$points$part_res)),
  range(c(ls_visreg$Incomes$bands$upper95, ls_visreg$Incomes$bands$lower95, ls_visreg$Incomes$points$part_res))
  )

ggplot(data = all_bands_df %>% filter(varname %in% vars_to_plot[12:13])) +
  geom_ribbon(aes(x = variable, ymin = lower95, ymax = upper95), fill = "grey80") + 
  geom_point(aes(x = variable, y = part_res), data = all_points_df %>% filter(varname %in% vars_to_plot[12:13]), size = 0.75, col = "grey50") + 
  geom_line(aes(x = variable, y = fitted), col = "blue", size = 1) +
  theme_bw() + 
  labs(x = varname, y = "Response") + 
  facet_wrap(varname ~ year, ncol = 6, scales = "free") +
  expand_limits(x = my_x_ranges[23:26], y = my_y_ranges[23:26])

# https://stackoverflow.com/questions/18046051/setting-individual-axis-limits-with-facet-wrap-and-scales-free-in-ggplot2

```


### A note on similar variables

Many of the Census variables represent similar information, which is why factors were created and some variables were removed. However, there still remain some variables which are closely related. For example, `OtherLanguageHome` is the proportion of households that speak a language other than English at home, which is likely to be related to the proportion of people born overseas (a sum of the variables with a `Born` prefix). In 2004, the coefficient estiamte for `OtherLanguageHome` negative but not significant, and all `Born` variables are insignificant. If all `Born` variables are removed from the model, `OtherLanguageHome` absorbs the negative effect, becoming significant ($p = 0.01$).

```{r removeolh, eval = F}
OLH04 <- my_fgls(full_formula, 
  my_data = model_df %>% filter(year == "2004") %>% dplyr::select(-starts_with("Born")),
  sp_weights = sp_weights_04)

summary(OLH04)$tTable
```

## A closer look at the residuals

```{r resids, include = F}
all_resids <- data.frame(
  Residuals = c(glsmod16$actual_residuals, glsmod13$actual_residuals, glsmod10$actual_residuals, glsmod07$actual_residuals, glsmod04$actual_residuals, glsmod01$actual_residuals),
  gls_residuals = c(glsmod16$residuals, glsmod13$residuals, glsmod10$residuals, glsmod07$residuals, glsmod04$residuals, glsmod01$residuals),
  bind_rows(
    glsmod16$my_data %>% left_join(tpp16 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod13$my_data %>% left_join(tpp13 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod10$my_data %>% left_join(tpp10 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod07$my_data %>% left_join(tpp07 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod04$my_data %>% left_join(tpp04 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod01$my_data %>% left_join(tpp01 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"))
) 
#%>% dplyr::select(Residuals, DivisionNm, UniqueID, StateAb, year, LNP_Percent, gls_residuals)
```

### Residuals by state

It is often hypothesized that states have systematic differences that cause their electorates to vote differently. Boxplots of residuals grouped by state reveal that only Tasmania and the Australian Capital Territory appear to have a state-specific effect that is not captured by the models. These states appear to have a bias towards Labor. There are few electorates in these states (five and two, respectively), so this might be due to incumbent effects rather than an actual state-specific bias.

```{r resstate, fig.cap = "Boxplot of residuals by state.", out.width="75%"}
all_resids %>% 
  ggplot(aes(x = StateAb, y = Residuals, col = StateAb)) + 
  geom_boxplot() + 
  geom_jitter(alpha = 0.4) +
  #geom_jitter(aes(label = DivisionNm, shape = year), alpha = 0.4) +
  #facet_wrap(~year) + 
  guides(col = F, shape = F, DivisionNm = F)
```

### Outlier electorates

In 

```{r readcooksd, include = F, echo=FALSE}
read_chunk('cooksd.R')
```

```{r getcooksd}
<<GetCookDistance>>
```

```{r cooksd, include = F}
cooksd_df <- data.frame(
  Residuals = c(glsmod16$actual_residuals, glsmod13$actual_residuals, glsmod10$actual_residuals, glsmod07$actual_residuals, glsmod04$actual_residuals, glsmod01$actual_residuals),
  gls_residuals = c(glsmod16$residuals, glsmod13$residuals, glsmod10$residuals, glsmod07$residuals, glsmod04$residuals, glsmod01$residuals),
  cooksd = c(glsmod16$cooksd, glsmod13$cooksd, glsmod10$cooksd, glsmod07$cooksd, glsmod04$cooksd, glsmod01$cooksd),
  bind_rows(
    glsmod16$my_data %>% left_join(tpp16 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod13$my_data %>% left_join(tpp13 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod10$my_data %>% left_join(tpp10 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod07$my_data %>% left_join(tpp07 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod04$my_data %>% left_join(tpp04 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"), 
    glsmod01$my_data %>% left_join(tpp01 %>% dplyr::select(DivisionNm, UniqueID, StateAb), by = "DivisionNm"))
) 
```

```{r plotcooksd, fig.cap = "Electorates' Cook's Distance values in each election."}
cooksd_df %>% 
  ggplot(aes(x = cooksd)) + 
  geom_dotplot() + 
  facet_wrap(~year, nrow = 1) + 
  coord_fixed(ratio = .5) +
  labs(x = "Cook's Distance", y = "")
```

```{r}
cooksd_df %>% 
  filter(cooksd > 0.13) %>% 
  select(DivisionNm, StateAb, year, cooksd, Residuals, LNP_Percent, everything()) %>% View
```

The dotplots in Figure \@ref(fig:plotcooksd) show that there are a few outliers in each election, using cook's distance as a measure of influence. The electorate of Sydney (NSW) has the largest cook's distance in 2001, 2004, 2007 and 2010, due to its diverse population (language, birthplace and religion), high number of defacto relationships,  high income, high household mobility and small amount of workers in extractive, distributive and transformative jobs. It has remained a strong supporter of the Labor party and is severely underpredicted by the model. Nearby in metropolitan NSW, the electorate of Wentworth is found to be an outlier in the 2010, 2013 and 2016 elections - coinciding with its Liberal member, Malcolm Turnbull, being the leader of the Liberal party. Wentworth was historically Liberal but increased its two-party vote by over 10 percentage points in 2010 with Turnbull as Liberal leader, whilst experiencing minimal change in its socio-demographics, causing the models to heavily underpredict its Liberal preference.

Melbourne Ports, an upper-middle class electorate just south of Melbourne's the central business district, 

### Electorates with largest residuals

The electorates Capricornia (QLD), Leichhardt (QLD) and Riverina (NSW) have the three largest maximum absolute residuals across the six elections. Capricornia is a swing electorate, which strongly supported Labor between 2001 and 2010, before being narrowly won by Liberal in the last two elections. It has many people working in extractive jobs, an above-average Christian population, and above-average proportion of de facto relationships. The model tends to overpredict its two-party preferred vote (in favour of the Liberal party). Leichhardt is an area encompassing the northernmost tip of Queensland and consists of mainly small indigenous communities and uninhabited rural areas, which was won by the Liberal party in all but the 2007 election. It too has an above-average proportion of de facto relationships, along with an above-average proportion of people moving houses and a high proportion of single parent households. The model consistently underpredicts its two-party vote. Riverina is a rural electorate of NSW, and has been a very safe Liberal (National) seat since 1980. It has a relatively monocultural population consisting of a high proportion of Australian citizens and Christians, an above-average amount of extractive jobs and below average education levels. Its Liberal preference is also underpredicted.

```{r eval = F}
all_resids %>% 
  group_by(UniqueID) %>% 
  mutate(max_res = max(abs(Residuals))) %>% 
  arrange(-max_res) %>% 
  filter(max_res > 13.4) %>% 
  dplyr::select(DivisionNm, LNP_Percent, year, everything())

all_resids %>% 
  group_by(year) %>% 
  mutate(yr_max = max(abs(Residuals))) %>% 
  filter(abs(Residuals) == yr_max) %>% 
  select(DivisionNm, StateAb, year, Residuals, LNP_Percent)

cooksd_df %>% 
  mutate(LNP_win = ifelse(LNP_Percent > 50, 1, 0),
    LNP_predicted = ifelse(LNP_Percent - Residuals > 50, 1, 0),
    correct = ifelse(LNP_win == LNP_predicted, 1, 0)) %>% 
  filter(correct == 0) %>% dim
  group_by(year) %>% 
  mutate(yr_max = max(abs(Residuals))) %>% 
  filter(abs(Residuals) == yr_max) %>% 
  select(DivisionNm, StateAb, year, Residuals, LNP_Percent)
```

```{r eval = F}
library(plotly)
ggplot(all_resids) + geom_jitter(aes(x = year, y = Residuals, label = DivisionNm))
ggplotly()

all_resids %>% 
  group_by(UniqueID) %>% 
  mutate(mean_res = mean(abs(Residuals)), min_res = min(abs(Residuals))) %>%
  filter(min_res > 5) %>%
  ungroup() %>% dplyr::select(Residuals, DivisionNm, year, min_res, mean_res, StateAb) %>% View
  ggplot(aes(x = year, y = Residuals, group = DivisionNm, col = DivisionNm, label = DivisionNm)) + 
  geom_line() + geom_point() +
  guides(col = F)
```

