---
title: "modelling"
author: "Jeremy Forbes"
date: "18/03/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Modelling
- Address the issue of changing variable scales (rent as example)
- Dimension reduction via PCA to group variables together
- Choosing an appropriate model - discuss the spatial element
- Akaike weights to derive a variable set for models
- Final model specification

## Modelling

With socio-demographic information now available for each electorate, each election is joined to the data  corresponding with its two-party preferred vote. Socio-demographic variables within each election year are standardized to have mean zero and variance one, to adjust for changing variable scales. For example, inflation-adjusted median rental prices increased across almost all electorates, with median rent of 200 dollars per week placing an electorate in the 90th percentile in 2001, but only the 30th percentile in 2016. The response, the two-party preferred vote in favour of the Liberal party (denoted $Y$), lies in the interval $(0,100)$, where $Y = 70$ would represent a 70% preference for Liberal, 30% for Labor. Since the observed values of $Y$ are never very close to 0 or 100 (minimum $24.05 \%$ and maximum $74.90 \%$), there is no need to impose the constraint of $Y \in [0,100]$.

An identical model specification is used across the six elections, with each election modelled separately. This allows for the socio-demographic effects to be estimated separately for each year, allowing for interpretation of temporal changes in these effects. This is prefereable over a single longitudinal model because it avoids any concerns of undue bias stemming from an incorrectly imposed time-varying restriction on any variable. Without such restrictions, a pooled cross-sectional model does not yield any distinct advantage over separate models. The panel approach is avoided because of how frequently electoral boundaries change, so any fixed or random effects models would be inappropriate. 

For each election a spatial error model [@Anselin99] is to be estimated, as electorates have a spatial structure and it is reasonable to expect errors to have spatial dependence. This is a common approach for modelling aggregate spatial units [@Anselin2002]. Spatial weights are calculated by allowing each electorate to be equally correlated with any electorate that shares any part of its boundary. A moran's I test of the two-party preferred vote finds overwhelming evidence significant spatial autocorrelation for each election ($p \le 7\cdot10^{-15}$). 

Let $\rho$ be the parameter governing the extent of spatial correlation, $\boldsymbol \varepsilon$ be a spherical error term, ${\bf W}$ be a matrix of spatial weights (containing information about the neighbouring regions), $\bf X$ is a matrix of socio-demographic covariates and $\boldsymbol \beta$ is a vector of regression coefficients.

The spatial error model is specified:

$${\bf y} = {\bf X} {\boldsymbol \beta} + ({\bf I}_n-\rho {\bf W})^{-1}{\boldsymbol \varepsilon}$$
Where $\varepsilon \sim N(0, \sigma^2)$. Estimation is done via maximum likelihood (using the `spdep` `R` package [@spdep]).

## Dimension reduction
With only $N = 150$ observations (electorates) in each election and $p = 63$ socio-demographic variables in each cross-section, any model using all variables would face serious problems with multi-collinearity and over-fitting, likely leading to erroneous conclusions regarding variable significance. Therefore a form of dimension reduction is adopted that involves a two-stage approach that results in the identification of a reduced predictor set, for which models are fit. 

The first step[^2] is to combine socio-demographic variables that represent similar information into "factors" using principal component analysis (PCA). The scree plots of the principal components for each election all level off after four components, and the loadings of these four components are similar across the elections. Principal components are then computed on the combined set of socio-demographics across all six elections. A factor is created by combining several variables all have large loadings in a particular component and when there is an intuitive reason as to why these variables could represent common information. A loading with magnitude greater than 0.15 is considered large. After computing these sums, each factor is again standardized to have mean zero and variance one, within each election. 

Consider the `Incomes` factor as an illustration. Independent of principal components, we may suspect that median personal income, median household income and median family income are providing similar information about the financial wellbeing of an electorate. Their loadings in the first principal component are large (0.20, 0.21 and 0.22 respectively), which provides the evidence needed to combine these variables into a single factor, which is called `Incomes`.

This process reduces the predictor set to $p = 30$. However, it is still relatively large, and an additional variable selection method is required. Our target is to end up with a smaller subset of variables in the final stage when we model each election.

[^2]: A preliminary step involved removing all age variables aside from median age.









----------------------------------------------------------------------------------------





Electorates One might suspect an underlying spatial dependence between electorates in their voting behaviour. This is  ggregate spatial units are commonly modelled with an ecological regression, which in this study takes the form  [@Anselin2002]. Electoral voting behaviour  assume the form of the spatial error model 

The spatial weight matrix $\bf W$ is therefore specified such that $W_{i,j} = 0$ if electorate $i$ does not share a border with electorate $j$, and $W_{i,j} = \frac{1}{N_i}$ if electorates $i$ and $j$ do share a border, where $N_i$ is the number of electorates that $i$ shares a border with. 


Talk about spatial dependence in the structure and decide on SEM.

Address problem of relatively small N large p. PCA for factors. Akaike weights for most important variables.

Interactions. Final model specification.





. As there are only $N = 150$ electorates in each election, the dimension of the cross-sections are reduced by grouping some variables together into factors. This is informed by principal component analysis. 

As there are $N=150$ electorates in each election, but *60*



An identical model specification is used across the six elections, with each election modelled separately. This enables the interpretation of temporal changes of the socio-demographic effects, as the same covariates are used in each election. The response, the two-party preferred vote, lies in the interval $(0,100)$, with $TPP = 70$ representing a 70% preference for Liberal, 30% for Labor. Since the observed values of $TPP$ are never very close to 0 or 100 (minimum $24.05 \%$ and maximum $74.90 \%$), there is no need to impose the constraint of $TPP \in [0,100]$. Furthermore, significant spatial autocorrelation in the response is found using a moran test for each election. Neighbours (and therefore spatial weights) are assigned based on whether electorates share a border (1) or do not (0). 

```{r}
# p values for moran test
```

A spatial error model (SEM) is fit to account for the spatial dependence, which is more efficient than OLS estimates. Before any variable selection, since there are only $N = 150$ electorates in each election and over *60* covariates available, the dimension of each cross-sections is reduced by grouping some variables together into factors. This is informed by principal component analysis. 


- Need to see if partial residuals are even relevant for spatial error model. If not, an alternative significance measure should be used. Errors are not spherical so doesn't make sense to use lm on partial residuals. Ask Rob perhaps?
- Perhaps test is SEM is even better than LM? If not, then go with LM. No harm done.







As there are only $N = 150$ electorates in each election, the dimension of the cross-sections are reduced by grouping some variables together into factors, before select



An identical model specification is used across the six elections, with each election modelled separately. This enables the interpretation of temporal changes of the socio-demographic effects, as the same covariates are used in each election. As there are only $N = 150$ electorates in each election, the dimension of the cross-sections are reduced by grouping some variables together into factors. This is informed by principal component analysis. 

As many of the socio-demographic variables represent similar information (for example, median personal income and median household income) many of the socio-demographic variables are grouped together into factors - informed by principal component analysis. This reduces the 

Before selecting what model to use, or which covariates to include, many of the socio-demographic variables are grouped together into factors - informed by principal component analysis. This reduces the 



The response, the two-party preferred vote, lies in the interval $(0,100)$, with $TPP = 70$ representing a 70% preference for Liberal, 30% for Labor. Since the observed values of $TPP$ are never very close to 0 or 100 (minimum $24.05 \%$ and maximum $74.90 \%$), there is no need to impose the constraint of $TPP \in [0,100]$. and so linear regression models are estimated using ordinary least squares.

Therefore, for a given election year, we assume $TPP \sim N(X \beta, \sigma^2)$, where $TPP$ is an $n \times 1$ vector containing $n=150$ two-party preferred votes, $X$ is an ($n \times p$) matrix of socio-demographic predictors, $\beta$ is a ($p \times 1$) vector of coefficients to be estimated. By assumption, the regression errors are taken to be independent and identically normally distributed with mean $0$ and variance $\sigma^2$. The estimation is done separately for each election.






Another option would is to combine these cross-sections into a single pooled cross-section with 900 observations, allowing for the construction of a longitudinal model. However, this would require placing some restrictions on which variables are time varying, which is unfavourable in this context. Alternatively it is possible to construct a panel data set for a particular set of electoral boundaries across all elections. This way we could potentially capture any unobserved individual heterogeneity using either fixed or random effects, but since electoral boundaries change, to construct panel data further spatial imputation would be required to generate socio-demographic profiles for each election with a common set of boundaries. Additionally, the two-party preferred vote would have to be imputed for these same boundaries, for all elections, which would introduce greater uncertainty. Finally, the same issues of choosing time-varying effects will arise in the panel data context as for the pooled cross-section.


Alternative without concern for undue bias stemming from an incorrectly imposed restriction on any variable.

Socio-demographic variables for each electorate have now been calculated and matched with the two-party preferred vote, for all six elections. In this chapter, we consider how to best answer the research question; *Which socio-demographics are the key determinants of support between the Labor and Liberal parties, and how have their effects changed over time?* This involves discussing an appropriate statistical model, reducing the dimension of the data by grouping similar variables together, selecting the most important predictors and adding interaction terms. Each of these four steps are described in subsections below, followed by the estimated models. 



On this basis, modelling each election as a separate cross-section seems to us as the most appropriate statistical model to pursue. By using identical model specification, effects may be compared across six different elections, enabling the interpretation of temporal changes without concern for undue bias stemming from an incorrectly imposed restriction on any variable.

### Response variable - two-party preferred vote

The two-party preferred vote is a measure of preference between only the two major parties (Labor and Liberal), and is oriented in favour of the Liberal party, sitting in the interval $(0,100)$. For example, $TPP = 70$ represents a 70% preference for Liberal, 30% for Labor. Since the observed values of $TPP$ are never very close to 0 or 100 (minimum $24.05 \%$ and maximum $74.90 \%$), there is no need to impose the constraint of $TPP \in [0,100]$ and so linear regression models are estimated using ordinary least squares.

Therefore, for a given election year, we assume $TPP \sim N(X \beta, \sigma^2)$, where $TPP$ is an $n \times 1$ vector containing $n=150$ two-party preferred votes, $X$ is an ($n \times p$) matrix of socio-demographic predictors, $\beta$ is a ($p \times 1$) vector of coefficients to be estimated. By assumption, the regression errors are taken to be independent and identically normally distributed with mean $0$ and variance $\sigma^2$. The estimation is done separately for each election.